# 22. Immerë¥¼ ì‚¬ìš©í•œ ë” ì‰¬ìš´ ë¶ˆë³€ì„± ê´€ë¦¬í•˜ê¸°

âœğŸ» [ë²¨ë¡œí¼íŠ¸ì”¨ì˜ ëª¨ë˜ ë¦¬ì•¡íŠ¸ ê°•ì¢Œ - 23í¸](https://react.vlpt.us/basic/23-immer.html) ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤.

## 1ï¸âƒ£ What is ë¶ˆë³€ì„±?

* ë¦¬ì•¡íŠ¸ì—ì„œ ë°°ì—´ì´ë‚˜ ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í•´ì•¼í•  ë•ŒëŠ” ì§ì ‘ ìˆ˜ì •í•˜ë©´ ì•ˆë˜ê³ , __ë¶ˆë³€ì„±ì„ ì§€ì¼œì£¼ë©´ì„œ ì—…ë°ì´íŠ¸ í•´ì•¼ í•œë‹¤.__
* ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í•  ë•Œ
    *   ~~~javascript
        const object = {
            a: 1,
            b: 2
        };

        // ì—…ë°ì´íŠ¸ ì´ë ‡ê²Œ í•˜ë©´ ì•ˆë¨
        object.b = 3;

        // ì—…ë°ì´íŠ¸ëŠ” ì´ë ‡ê²Œ í•´ì•¼ í•¨(ë¶ˆë³€ì„±ì„ ì§€ì¼œì„œ ìƒˆë¡œìš´ ê°ì²´ ë§Œë“¤ê¸°)
        const newObject = {
            ...object,
            b: 3
        };
        ~~~
* ë°°ì—´ì„ ì—…ë°ì´íŠ¸ í•  ë•Œ
    *   ~~~javascript
        const todos = [
            {
                id: 1,
                title: "ë¬¼ ë§ˆì‹œê¸°"
            },
            {
                id: 2,
                title: "ë¦¬ì•¡íŠ¸ ê³µë¶€í•˜ê¸°"
            }
        ]

        // ë°°ì—´ ì—…ë°ì´íŠ¸í•˜ê¸° ë°©ë²• 1 ) concat() í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°
        const newTodos = todos.concat({
            id: 3,
            title: "ë¹¨ë˜í•˜ê¸°"
        })

        // ë°°ì—´ ì—…ë°ì´íŠ¸í•˜ê¸° ë°©ë²• 2 ) filter() í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°
        const newTodos2 = todos.filter(todo => todo.id !== 2);

        // ë°°ì—´ ì—…ë°ì´íŠ¸í•˜ê¸° ë°©ë²• 3 ) map() í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°
        const newTodos3 = todos.map(todo => 
            todo.id === 2 ? {
                ...todo,
                title: "í• ì¼ ë"
            } : todo
        )
        ~~~
* ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ë¶ˆë³€ì„±ì„ ì§€ì¼œì„œ ê°ì²´ë‚˜ ë°°ì—´ì„ ì—…ë°ì´íŠ¸ í•´ì£¼ëŠ” ë°©ë²•ì€ ë°ì´í„°ì˜ êµ¬ì¡°ê°€ ì¡°ê¸ˆ ê¹Œë‹¤ë¡œì›Œì§€ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§ˆ ê°€ëŠ¥ì„±ì´ ìˆë‹¤.
*   ~~~javascript
    const state = {
        posts: [
            {
                id: 1,
                title: 'ì œëª©1',
                body: 'ë‚´ìš©ì…ë‹ˆë‹¤.',
                comments: [
                    {
                        id: 1,
                        text:'ê¸€ ì¢‹ë„¤ìš”'
                    }
                ]
            }
        ]
    }
    ~~~

    * ìœ„ ì½”ë“œì—ì„œ post idê°€ 1ì¸ ê°ì²´ë¥¼ ì°¾ì•„ commentë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤ë©´? ì•„ë˜ì™€ ê°™ì€ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼ í•œë‹¤.
    *   ~~~javascript
        const newState = {
            ...state,
            posts: state.post.map(post =>
                post.id === 1 ? {
                    ...post,
                    comments: post.comments.concat({
                        id: 2,
                        text: 'ìƒˆë¡œìš´ ëŒ“ê¸€'
                    })
                }
            )
        }
        ~~~
    * ìœ„ ì½”ë“œëŠ” ì‹œê°ì ìœ¼ë¡œ ë³µì¡í•œ ì½”ë“œì´ë‹¤! ã… ã… 
* __í•´ê²°ë°©ë²•__
    * ë¦¬ì•¡íŠ¸ì—ì„œ ê°ì²´ë‚˜ ë°°ì—´ì„ ë¶ˆë³€ì„±ì„ ì§€í‚¤ë©´ì„œ ì—…ë°ì´íŠ¸í•  ë•Œ ì½”ë“œê°€ ë³µì¡í•´ì§€ëŠ” ê²ƒì„ í•´ê²°í•˜ê¸° ìœ„í•´ __immer ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬__ ë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤.

## 2ï¸âƒ£ Immer ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ë²•

* í”„ë¡œì íŠ¸ í´ë”ì— Immer ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•˜ê¸°
    *   ~~~javascript
        yarn add immer
        ~~~
* ì½”ë“œ íŒŒì¼ ìƒë‹¨ì—ì„œ immerì„ ë¶ˆëŸ¬ì˜¤ê¸°(ë³´í†µ produce ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë¶ˆëŸ¬ì˜´)
    *   ~~~javascript
        import produce from 'immer';
        ~~~
* produce í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ì¸ìì—ëŠ” ìˆ˜ì •í•˜ê³  ì‹¶ì€ ìƒíƒœ(ê°ì²´ or ë°°ì—´), ë‘ ë²ˆì§¸ ì¸ìì—ëŠ” ì–´ë–»ê²Œ ì—…ë°ì´íŠ¸í•˜ê³  ì‹¶ì€ì§€ë¥¼ ì •ì˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì „ë‹¬í•œë‹¤.
    *   ~~~javascript
        const state = {
            number: 1,
            dontChangeMe: 2
        }

        // produce() í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ìµëª… í•¨ìˆ˜ë¥¼ ë„£ì–´ì¤€ ëª¨ìŠµì´ë‹¤.
        const newState = produce(state, draft => {
            draft.number += 1
        })
        ~~~
    * ë‘ ë²ˆì§¸ ì¸ìì—ì„œ ë¶ˆë³€ì„±ì„ ì‹ ê²½ì“°ì§€ ì•Šê³ , ì—…ë°ì´íŠ¸í•´ì£¼ê³  ì‹¶ì€ ë°ì´í„°ë§Œ ë°”ë¡œ ìˆ˜ì • ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œ ë³µì¡ì„±ì´ ì¤„ì–´ë“ ë‹¤!
    * í•˜ì§€ë§Œ immerë¥¼ ì‚¬ìš©í•œë‹¤ê³  ëª¨ë“  ì½”ë“œê°€ ë‹¨ìˆœí•´ì§€ì§€ëŠ” ì•ŠëŠ”ë‹¤. ìƒí™©ì— ë§ê²Œ ì í•©í•œ ê³³ì—ë§Œ ì‚¬ìš©í•˜ê¸°!
    * ë˜.. immerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì½”ë“œê°€ ì„±ëŠ¥ì ìœ¼ë¡œëŠ” ì¡°ê¸ˆ ë” ë¹ ë¥´ë‹¤..

## 3ï¸âƒ£ ì‹¤ìŠµí•´ë³´ê¸°

* ê³„ì† ì´ì–´ì„œ ì‘ì„±í•´ì˜¤ë˜ í”„ë¡œì íŠ¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì½”ë“œë¥¼ immerë¥¼ ì‚¬ìš©í•œ ì½”ë“œë¡œ ë°”ê¿”ë³´ê¸°
*   ~~~javascript
    // App.js
    ...
    
    // reducer í•¨ìˆ˜ì˜ ì—…ë°ì´íŠ¸ ì½”ë“œë¥¼ immerë¥¼ ì‚¬ìš©í•œ ì½”ë“œë¡œ ë°”ê¿ˆ
    function reducer(state, action) {
        switch(action.type) {
            case 'CREATE_USER':
            return produce(state, draft => {
                draft.users.push(action.user);
                })
            case 'TOGGLE_USER':
            return produce(state, draft => {
                const user = draft.users.find(user => user.id === action.id);
                user.active = !user.active;
            })
            case 'REMOVE_USER':
            return produce(state, draft => {
                const index = draft.users.findIndex(user => user.id === action.id);
                draft.users.splice(index, 1);
            })
            default:
            return state;
        }
    }
    ~~~

# ë!