# 19. useReducer ì‚¬ìš©í•´ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸ ë¡œì§ ë¶„ë¦¬í•˜ê¸°

âœğŸ» [ë²¨ë¡œí¼íŠ¸ì”¨ì˜ ëª¨ë˜ ë¦¬ì•¡íŠ¸ ê°•ì¢Œ - 20í¸](https://react.vlpt.us/basic/20-useReducer.html) ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤.

## 1ï¸âƒ£ What is useReducer?

* ê³„ì† ì´ì–´ì„œ í•´ì˜¤ë˜ array-create-remove-modify-app í”„ë¡œì íŠ¸ì—ì„œ ëŒ€ë¶€ë¶„ì˜ ìƒíƒœëŠ” App.jsì— ì¡´ì¬í–ˆê³ , useStateë¥¼ í†µí•´ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í–ˆìŒ
* __ë¬¸ì œ ìƒí™©__
    
    * ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë‚˜ ë¡œì§ì´ App.jsì— ëª°ë ¤ìˆìŒ. ìƒíƒœ ì—…ë°ì´íŠ¸ ë¡œì§ ë¶„ë¦¬ í•„ìš”!

* __í•´ê²° ë°©ë²•__

    * ìƒíƒœ ì—…ë°ì´íŠ¸ ë¡œì§ì„ App.jsì™€ ë¶„ë¦¬í•´ì•¼ í•¨
    * ìƒíƒœ ê´€ë¦¬í•  ë•Œ useStateë§ê³  useReducerë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆìŒ
    * useReducer ì‚¬ìš©í•´ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ App.js ë‘ ë¶„ë¦¬í•  ìˆ˜ ìˆìŒ
    * ìƒíƒœ ë¡œì§ ì½”ë“œë¥¼ ì»´í¬ë„ŒíŠ¸ ë¸”ëŸ­ ì™¸ë¶€ì— ì‘ì„±í•  ìˆ˜ë„ ìˆê³ , ë‹¤ë¥¸ íŒŒì¼ì— ì‘ì„±í•´ì„œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ë„ ìˆìŒ

## 2ï¸âƒ£ useReducer ì‚¬ìš©ë²•

* UseState í´ë”ì˜ use-state-app ê³¼ ê°™ì€ í”„ë¡œì íŠ¸ ì¤€ë¹„
* UseReducer í´ë”ì— use-state-app í”„ë¡œì íŠ¸ì™€ ê°™ì€ í”„ë¡œì íŠ¸ë¥¼ ì‘ì„±í•¨
* __reducerì˜ ì˜ë¯¸__
    * í˜„ì¬ ìƒíƒœì™€ action ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì™€ì„œ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°˜í™˜í•´ì£¼ëŠ” í•¨ìˆ˜
    * 
        ~~~javascript
        // reducer í•¨ìˆ˜ ì˜ˆì œ
        function reducer(state, action) {
            // ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë§Œë“œëŠ” ë¡œì§
            // const nextState = ...
            return nextState;
        }
        ~~~
    * reducer í•¨ìˆ˜ê°€ returní•˜ëŠ” ìƒíƒœëŠ” ê³§ ì»´í¬ë„ŒíŠ¸ê°€ ì§€ë‹ ìƒˆë¡œìš´ ìƒíƒœì„.
    * action ê°ì²´ëŠ” ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê°ì²´.(action ê°ì²´ í˜•íƒœëŠ” ììœ ì„ but, type ì´ë¦„ì„ ëŒ€ë¬¸ìì™€ _ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§“ëŠ” ê´€ìŠµì´ ìˆìŒ)
    * 
        ~~~javascript
        // action ì˜ˆì‹œ

        // ì¹´ìš´í„°ì— 1ì„ ë”í•˜ëŠ” ì•¡ì…˜
        {
            type: 'INCREMENT'
        }
        // ì¹´ìš´í„°ì— 1ì„ ë¹¼ëŠ” ì•¡ì…˜
        {
            type: 'DECREMENT'
        }
        // input ê°’ì„ ë°”ê¾¸ëŠ” ì•¡ì…˜
        {
            type: 'CHANGE_INPUT',
            key: 'email',
            value: 'tester@react.com'
        }
        // ìƒˆ í•  ì¼ì„ ë“±ë¡í•˜ëŠ” ì•¡ì…˜
        {
            type: 'ADD_TODO',
            todo: {
                id: 1,
                text: 'useReducer ë°°ìš°ê¸°',
                done: false,
            }
        }
        ~~~
* __useReducer ì‚¬ìš©ë²•__
    * useReducer ì„ ì–¸í•˜ê¸°
        ~~~javascript
        const [state, dispatch] = useReducer(reducer, initialState);
        ~~~
    * __state__ : ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© ë° ê´€ë¦¬í•  ìƒíƒœ
    * __dispatch__ : ì•¡ì…˜ì„ ë°œìƒì‹œí‚¤ëŠ” í•¨ìˆ˜
        ~~~javascript
        // dispatch ì˜ˆì‹œ
        dispatch({
            type: 'ADD_TODO'
        })
        ~~~
    * __useReducer() í•¨ìˆ˜ ì²« ë²ˆì§¸ ì¸ì__ : reducer í•¨ìˆ˜
    * __useReducer() í•¨ìˆ˜ ë‘ ë²ˆì§¸ ì¸ì__ : ìƒíƒœ ì´ˆê¸°ê°’
* Counter.js íŒŒì¼ì— reducer í•¨ìˆ˜ ë§Œë“¤ê¸°
    ~~~javascript
    // Counter.js
    // 1. reducer í•¨ìˆ˜ ë§Œë“¤ê¸°
    function reducer(state, action) {
        switch(action.type) {
            case 'INCREASE':
                return state + 1;
            case 'DECREASE':
                return state - 1;
            default:
                return state;
        }
    }

    function Counter() {
        ...
    }
    ~~~
* useReducer í•¨ìˆ˜ ì„ ì–¸í•˜ê¸°

    ê¸°ì¡´ì— useStateë¡œ ê´€ë¦¬í•˜ë˜ ê²ƒë“¤ ë‹¤ ì‚­ì œí•˜ê³  useReducerë¡œ ê´€ë¦¬í•  ê²ƒì„.
    ~~~javascript
    // Counter.js
    function reducer(state, action) {
        switch(action.type) {
            case 'INCREASE':
                return state + 1;
            case 'DECREASE':
                return state - 1;
            default:
                return state;
        }
    }

    function Counter() {
        // 1. useReducer() í•¨ìˆ˜ ì„ ì–¸í•˜ê¸°
        const [number, dispatch] = useReducer(reducer, 0);
        ...
    }
    ~~~
* dispatchë¡œ ì•¡ì…˜ ë°œìƒì‹œí‚¤ê¸°
    ~~~javascript
    // Counter.js
    
    ...

    function Counter() {
        const [number, dispatch] = useReducer(reducer, 0);
        ...

        const onIncrease = () => {
            // 1. ì•¡ì…˜ ë°œìƒ
            dispatch({
                type: 'INCREASE'
            });
            console.log('+1')
        }
        const onDecrease = () => {
            // 2. ì•¡ì…˜ ë°œìƒ
            dispatch({
                type: 'DECREASE'
            });
            console.log('-1')
        }
    }
    ~~~
* ê²°ê³¼
    ![useReducer01](https://user-images.githubusercontent.com/31889335/103212436-1a276c00-494e-11eb-83d8-3fe20085cfd0.gif)
* ì´ì œ Counter í”„ë¡œì íŠ¸ ë§ê³  ê¸°ì¡´ì˜ ArrayCreateRemoveModify í”„ë¡œì íŠ¸ë¥¼ useReducer ì‚¬ìš©í•´ì„œ ìƒíƒœ ê´€ë¦¬ í•´ë³´ì.
    * ë¨¼ì € App ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ì´ˆê¸° ìƒíƒœë¥¼ App() í•¨ìˆ˜ ë°–ìœ¼ë¡œ ë¹¼ì£¼ê³ , App() í•¨ìˆ˜ ë‚´ë¶€ëŠ” ë‹¤ ì§€ì›Œì£¼ì. (ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë§Œë“ ë‹¨ ë§ˆì¸ë“œ,,)
        ~~~javascript
        // App.js
        // useReducerë¡œ ê´€ë¦¬í•  ìƒíƒœ ì´ˆê¸°ê°’(ìƒˆë¡œìš´ ìœ ì € ìƒíƒœ, ìœ ì € ë°°ì—´ ìƒíƒœë¥¼ í•˜ë‚˜ë¡œ í•©ì³ì„œ ê´€ë¦¬)
        const initialState = {
            newUserInputs: {
                username: '',
                nickname: ''
            },
            users: [
                {
                    id: 1,
                    username: 'ê¹€ì´ˆí¬',
                    nickname: 'ì´ˆë°¥',
                    active: true
                },
                {
                    id: 2,
                    username: 'ê¹€ë¯¸ì„±',
                    nickname: 'í‚´ë§ˆì„±',
                    active: true
                },
                {
                    id: 3,
                    username: 'ê¹€ê±´í›ˆ',
                    nickname: 'ë…¸ë£¨ì°¸ì¹˜',
                    active: false
                },
                {
                    id: 4,
                    username: 'ì¡°ì¸í˜',
                    nickname: 'ì˜¤í•¨ë§ˆ',
                    active: true
                },
                {
                    id: 5,
                    username: 'ì‹ ì„±ì¼',
                    nickname: 'ë¡œë´‡',
                    active: false
                }
            ]
        }

        function App() {

            return (
                <>
                <div>ë¦¬ì•¡íŠ¸ ìŠ¤í„°ë””ì›ë“¤ì´ ëˆ„êµ¬ëˆ„êµ¬ìˆê²¡ğŸ‘©ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»</div>
                <div>ë³„ëª…ë‘ ë§ì¶°ë°”~~!</div>
                
                <CreateUser />
                <UserList users={[]}/>
                <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{}</b> ëª…!</div>
                </>
            );
        }
        ~~~
    * reducer í•¨ìˆ˜ í‹€ë§Œ App() ë°”ê¹¥ì— ë§Œë“¤ì–´ ë†“ê³ , App() ì•ˆì—ì„œ useReducer ì„ ì–¸í•œ í›„, stateì—ì„œ í•„ìš”í•œ ê°’ë“¤ì„ ë¹„êµ¬ì¡°í™” í• ë‹¹ ë¬¸ë²•ì„ í†µí•´ ì¶”ì¶œí•˜ê¸°
        ~~~javascript
        // App.js
        // 1. reducer í•¨ìˆ˜ í‹€ë§Œ ë§Œë“¤ê¸°
        function reducer(state, action) {
            return state;
        }

        function App() {
            // 2. useReducer ì„ ì–¸í•˜ê¸°
            const [state, dispatch] = useReducer(reducer, initialState);

            // 3. ë¹„êµ¬ì¡°í• ë‹¹ ë¬¸ë²•ìœ¼ë¡œ users ë°°ì—´ê³¼ username, nickname ì¶”ì¶œí•˜ê¸°
            const { users } = state;
            const { username, nickname } = state.newUserInputs;

            return (
                <>
                <div>ë¦¬ì•¡íŠ¸ ìŠ¤í„°ë””ì›ë“¤ì´ ëˆ„êµ¬ëˆ„êµ¬ìˆê²¡ğŸ‘©ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»</div>
                <div>ë³„ëª…ë‘ ë§ì¶°ë°”~~!</div>
                
                <CreateUser />
                <UserList users={[]}/>
                <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{}</b> ëª…!</div>
                </>
            );
        }
        ~~~
    * onChange êµ¬í˜„í•˜ê¸° : reducer í•¨ìˆ˜ì— action ì¶”ê°€í•˜ê³ , onChange í•¨ìˆ˜ ì•ˆì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒí•˜ê¸°
        ~~~javascript
        // App.js
        function reducer(state, action) {
            // 1. reducer í•¨ìˆ˜ì— ì•¡ì…˜ ì¶”ê°€í•˜ê¸°
            switch(action.type) {
                case 'CHANGE_INPUT':
                    return{
                        ...state,
                        newUserInputs: {
                        ...state.newUserInputs,
                        [action.name]: action.value
                        }
                    }
                default:
                    return state;
            }
        }

        function App() {
            ...

            // 2. onChange í•¨ìˆ˜ì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒì‹œí‚¤ê¸°
            const onChange = useCallback((e) => {
                const { name, value } = e.target;
                    dispatch({
                        type: 'CHANGE_INPUT',
                        name,
                        value
                    })
            },[]);

            return (
                <>
                    <div>ë¦¬ì•¡íŠ¸ ìŠ¤í„°ë””ì›ë“¤ì´ ëˆ„êµ¬ëˆ„êµ¬ìˆê²¡ğŸ‘©ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»</div>
                    <div>ë³„ëª…ë‘ ë§ì¶°ë°”~~!</div>
                    
                    {/* 3. propsì— ì „ë‹¬í•˜ê¸° */}
                    <CreateUser username={username} nickname={nickname} onChange={onChange} />
                    <UserList users={users}/>
                    <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{}</b> ëª…!</div>
                </>
            );
        }
        ~~~
    * onCreate í•¨ìˆ˜ êµ¬í˜„í•˜ê¸° : reducer í•¨ìˆ˜ì— action ì¶”ê°€í•˜ê³ , onCreate í•¨ìˆ˜ ì•ˆì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒí•˜ê¸°
        ~~~javascript
        // App.js
        function reducer(state, action) {
            switch(action.type) {
                case 'CHANGE_INPUT':
                    return{
                        ...state,
                        newUserInputs: {
                        ...state.newUserInputs,
                        [action.name]: action.value
                        }
                    }
                // 1. reducer í•¨ìˆ˜ì— ì•¡ì…˜ ì¶”ê°€í•˜ê¸°
                case 'CREATE_USER':
                    return {
                        // input ì´ˆê¸°í™”
                        newUserInputs: initialState.newUserInputs,
                        users: state.users.concat(action.user)
                    }
                default:
                    return state;
            }
        }

        function App() {
            ...

            // 2. onCreate í•¨ìˆ˜ì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒì‹œí‚¤ê¸°
            const nextId = useRef(6);

            const onCreate = useCallback(() => {
                dispatch({
                    type: 'CREATE_USER',
                    user: {
                        id: nextId.current,
                        username,
                        nickname
                    }
                });

                nextId.current += 1;
            },
            [username, nickname]);

            return (
                <>
                    <div>ë¦¬ì•¡íŠ¸ ìŠ¤í„°ë””ì›ë“¤ì´ ëˆ„êµ¬ëˆ„êµ¬ìˆê²¡ğŸ‘©ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»</div>
                    <div>ë³„ëª…ë‘ ë§ì¶°ë°”~~!</div>
                    
                    {/* 3. propsì— ì „ë‹¬í•˜ê¸° */}
                    <CreateUser username={username} nickname={nickname} onChange={onChange} onCreate={onCreate} />
                    <UserList users={users}/>
                    <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{}</b> ëª…!</div>
                </>
            );
        }
        ~~~
    * onToogle í•¨ìˆ˜ êµ¬í˜„í•˜ê¸° : reducer í•¨ìˆ˜ì— action ì¶”ê°€í•˜ê³ , onToogle í•¨ìˆ˜ ì•ˆì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒí•˜ê¸°
        ~~~javascript
        // App.js
        function reducer(state, action) {
            switch(action.type) {
                ...
                
                // 1. ì•¡ì…˜ ì¶”ê°€í•˜ê¸°
                case 'TOGGLE_USER':
                    return {
                        ...state,
                        users: state.users.map(user => user.id === action.id ? {...user, active: !user.active} : user)
                    }
                default:
                    return state;
            }
        }

        function App() {
            ...

            // 2. onToggle í•¨ìˆ˜ì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒì‹œí‚¤ê¸°
            const onToggle = useCallback((id) => {
                dispatch({
                    type: 'TOGGLE_USER',
                    id
                })
            },[]);
            

            return (
                <>
                    ...
                    
                    {/* 3. propsì— ì „ë‹¬í•˜ê¸° */}
                    <UserList users={users} onToggle={onToggle}/>
                    <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{}</b> ëª…!</div>
                </>
            );
        }
        ~~~
    * onRemove í•¨ìˆ˜ êµ¬í˜„í•˜ê¸° : reducer í•¨ìˆ˜ì— action ì¶”ê°€í•˜ê³ , onRemove í•¨ìˆ˜ ì•ˆì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒí•˜ê¸°
        ~~~javascript
        // App.js
        function reducer(state, action) {
            switch(action.type) {
                ...
                
                // 1. ì•¡ì…˜ ì¶”ê°€í•˜ê¸°
                case 'REMOVE_USER':
                    return {
                        ...state,
                        users: state.users.filter(user => user.id !== action.id)
                    }
                default:
                    return state;
            }
        }

        function App() {
            ...

            // 2. onRemove í•¨ìˆ˜ì—ì„œ dispatchë¡œ ì•¡ì…˜ ë°œìƒì‹œí‚¤ê¸°
            const onRemove = useCallback((id) => {
                dispatch({
                    type: 'REMOVE_USER',
                    id
                })
            },[]);
            

            return (
                <>
                    ...
                    
                    {/* 3. propsì— ì „ë‹¬í•˜ê¸° */}
                    <UserList users={users} onToggle={onToggle} onRemove={onRemove}/>
                    <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{}</b> ëª…!</div>
                </>
            );
        }
        ~~~
    * í™œì„± ì‚¬ìš©ì ìˆ˜ êµ¬í˜„í•˜ê¸°
        ~~~javascript
        // App.js
        // 1. í™œì„± ì‚¬ìš©ì ìˆ˜ êµ¬í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€í•˜ê¸°
        function countActiveUsers(users) {
            console.log('í™œì„± ì‚¬ìš©ì ìˆ˜ ì„¸ëŠ” ì¤‘..');
            return users.filter(user => user.active === true).length;
        }

        ...
        function App() {
            ...
            // 2. ë³€ìˆ˜ë¡œ ë°›ì•„ì˜¤ê¸°
            const count = useMemo(() => countActiveUsers(users), [users]);

            return(
                <>
                    ...
                    {/* 3. propsì— ì „ë‹¬í•˜ê¸° */}
                    <div>ìŠ¤í„°ë””ì— í™œë°œíˆ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì‚¬ëŒ ìˆ˜ëŠ”?: <b>{count}</b> ëª…!</div>
                </>
            )
        }
        ~~~
    * ì´ë ‡ê²Œê¹Œì§€ í•˜ë©´ useStateë¡œ ê´€ë¦¬í–ˆë˜ ëª¨ë“  ìƒíƒœë“¤ì„ useReducerë¡œ ê´€ë¦¬í•˜ë„ë¡ ë°”ê¾¼ê²ƒì´ ëœë‹¤!

## 3ï¸âƒ£ ìƒíƒœ ê´€ë¦¬í•  ë•Œ useState vs useReducer ë­ ì“¸ê¹Œ?

* ë­˜ ì¨ì•¼í• ì§€ëŠ” ë‹µì´ ì •í•´ì ¸ìˆì§€ ì•ŠìŒ
* ë§Œì•½ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìƒíƒœ ê°’ì´ ì ê³ , ë‹¨ìˆœí•œ ìˆ«ì, ë¬¸ìì—´, boolean ê°’ì´ë¼ë©´ useStateë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ í¸í•¨
* ë§Œì•½ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìƒíƒœ ê°’ì´ ë³µì¡í•˜ë©´ useReducerë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ í¸í•¨

# ë!